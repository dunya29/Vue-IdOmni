import{z as C,w as N,o as r,p as f,e,j as w,v as L,t as k,q as y,n as $,i as A,r as _,A as b,g as x,d as P,h,R as S,B,c as v,_ as O,D as p,E as V,F as I,T,G as D}from"./index-DG9AaiDl.js";import{_ as R,a as z}from"./sprite-CHqdjsJe.js";const E={class:"clients-docs__form"},F={class:"form__fieldset"},M={class:"form__items"},U={class:"item-form"},G={key:0,"data-error":""},j={class:"form__footer"},q=["disabled"],H={__name:"AddPage",props:{addPageLoading:Boolean,formSuccess:Number},emits:["addNewPage"],setup(o,{emit:g}){const c=o,s=g,a=C({value:"",error:!1,errorTxt:"Заполните поле"}),l=()=>{if(a.error=!a.value,!a.error){let i={title:a.value};s("addNewPage",i)}};return N(()=>c.formSuccess,()=>{a.value=""}),(i,d)=>(r(),f("div",E,[d[1]||(d[1]=e("h2",null,"Создать новую страницу",-1)),e("form",{class:"form",action:"",onSubmit:A(l,["prevent"])},[e("div",F,[e("div",M,[e("div",U,[w(e("input",{type:"text",name:"title",placeholder:"Название страницы*","onUpdate:modelValue":d[0]||(d[0]=u=>a.value=u)},null,512),[[L,a.value]]),a.error?(r(),f("div",G,k(a.errorTxt),1)):y("",!0)])])]),e("div",j,[e("button",{type:"submit",class:"btn-reset main-btn",disabled:o.addPageLoading},[e("span",{class:$(o.addPageLoading&&"loading")},"Добавить страницу",2)],8,q)])],32)]))}},J=z+"#del",K={class:"item-doc"},Q={class:"card-anim item-doc__inner"},W={class:"item-doc__content"},X={class:"item-doc__action"},Y={__name:"CatalogItem",props:{id:Number,title:String,isAdmin:Boolean},emits:["delPage","pageNameOnChange"],setup(o,{emit:g}){const c=o,s=_(null),a=_(c.title),l=g,i=()=>{s.value.style.height="",s.value.style.height=s.value.scrollHeight+"px"},d=()=>{let u={title:a.value};l("pageNameOnChange",c.id,u)};return b(()=>{window.addEventListener("resize",i)}),N(s,i),(u,t)=>(r(),f("div",K,[e("div",Q,[e("div",W,[e("h3",null,[w(e("textarea",{ref_key:"pageNameRef",ref:s,"onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),onInput:t[1]||(t[1]=()=>i()),onChange:t[2]||(t[2]=()=>d())},null,544),[[L,a.value]])]),e("div",X,[x(h(S),{to:"/catalog/"+o.id,class:"item-doc__btn"},{default:P(()=>t[4]||(t[4]=[e("span",null,"Открыть",-1),e("img",{src:R,alt:""},null,-1)])),_:1},8,["to"]),o.isAdmin?(r(),f("button",{key:0,onClick:t[3]||(t[3]=()=>l("delPage",o.id)),class:"btn-reset item-doc__btn item-doc__btn--del"},t[5]||(t[5]=[e("svg",null,[e("use",{"xlink:href":J})],-1)]))):y("",!0)])])])]))}},Z={class:"section intro clients-docs"},ee={class:"container"},te={class:"clients-docs__items"},ne={__name:"CatalogPage",setup(o){const g=_([]),c=_(0),s=_({setPagesLoading:!1,addPageloading:!1}),{isAdmin:a}=B(),l=async()=>{s.setPagesLoading=!0;try{const{data:t}=await p.getPages();g.value=t}catch(t){console.log(t)}finally{s.setPagesLoading=!1}},i=async t=>{s.setPagesLoading=!0;try{await p.delPage(t),l()}catch(n){console.log(n),s.setPagesLoading=!1}},d=async t=>{s.addPageLoading=!0;try{await p.postPage(t),l(),c.value++}catch(n){console.log(n)}finally{s.addPageLoading=!1}},u=async(t,n)=>{try{await p.changePageName(t,n),fetchItems()}catch(m){console.log(m)}};return D("delPage",i),b(l),(t,n)=>(r(),v(O,null,{default:P(()=>[e("section",Z,[e("div",ee,[n[1]||(n[1]=e("div",{class:"sec-top"},[e("h1",null,"Каталог"),e("p",null,"Доступные вам инструкции на ваши сайты вы найдете ниже."),e("p",null,"Если вам кажется, что чего-то не хватает, или вам что-то непонятно, пожалуйста свяжитесь с нами")],-1)),e("div",te,[n[0]||(n[0]=e("div",{class:"clients-docs__title"},[e("h2",null,"Список страниц")],-1)),x(T,{type:"transition",name:"fadeUp"},{default:P(()=>[(r(!0),f(I,null,V(g.value,m=>(r(),v(Y,{key:m.id,id:m.id,title:m.title,isAdmin:h(a),onPageNameOnChange:u,onDelPage:i},null,8,["id","title","isAdmin"]))),128))]),_:1})]),h(a)?(r(),v(H,{key:0,formSuccess:c.value,addPageLoading:s.value.addPageLoading,onAddNewPage:d},null,8,["formSuccess","addPageLoading"])):y("",!0)])])]),_:1}))}};export{ne as default};
